/** @odoo-module **/

import { loadJS } from "@web/core/assets";
import { Component } from "@odoo/owl";
import { useRef, onWillStart, useEffect, onWillUnmount } from "@odoo/owl";

export class Crypto extends Component {
    static template = "crypto.Crypto";
    static props = { period: String, error: String, title: String, data: Object };
    setup() {
        this.canvasRef = useRef("canvas");
        this.chart = null;

        onWillStart(async () => {
            await loadJS("/rok_spreadsheet/static/lib/chart.js");
            // Load date adapter for time scales
            await loadJS("/rok_spreadsheet/static/lib/chartjs-adapter-date-fns.bundle.min.js");
        });

        useEffect(() => this.renderChart());
        onWillUnmount(this.onWillUnmount);
    }

    onWillUnmount() {
        if (this.chart) {
            this.chart.destroy();
        }
    }

    renderChart() {
        if (this.chart) {
            this.chart.destroy();
        }
        if (this.canvasRef.el) {
            const ctx = this.canvasRef.el;
            const config = this.getChartConfig();
            // const config = {
            //     type: 'bar',
            //     data: {
            //         labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            //         datasets: [{
            //             label: '# of Votes',
            //             data: [12, 19, 3, 5, 2, 3],
            //             borderWidth: 1
            //         }]
            //     },
            //     options: {
            //         scales: {
            //             y: {
            //             beginAtZero: true
            //             }
            //         }
            //     }
            // };
            this.chart = new Chart(ctx, config);
        }
    }

    getLineChartData() {
        // const { cumulated } = this.model.metaData;
        // debugger;
        // const data = this.model.data;
        // for (let index = 0; index < data.datasets.length; ++index) {
        //     const dataset = data.datasets[index];
        //     const itemColor = getColor(index, colorScheme, data.datasets.length);
        //     dataset.backgroundColor = getCustomColor(
        //         colorScheme,
        //         lightenColor(itemColor, 0.5),
        //         darkenColor(itemColor, 0.5)
        //     );
        //     dataset.cubicInterpolationMode = "monotone";
        //     dataset.borderColor = itemColor;
        //     dataset.borderWidth = 2;
        //     dataset.hoverBackgroundColor = dataset.borderColor;
        //     dataset.pointRadius = 3;
        //     dataset.pointHoverRadius = 6;
        //     // if (cumulated) {
        //     //     let accumulator = dataset.cumulatedStart;
        //     //     dataset.data = dataset.data.map((value) => {
        //     //         accumulator += value;
        //     //         return accumulator;
        //     //     });
        //     // }
        //     if (data.labels.length === 1) {
        //         // shift of the real value to right. This is done to
        //         // center the points in the chart. See data.labels below in
        //         // Chart parameters
        //         dataset.data.unshift(undefined);
        //         dataset.trueLabels.unshift(undefined);
        //         dataset.domains.unshift(undefined);
        //     }
        //     dataset.pointBackgroundColor = dataset.borderColor;
        // }
        // // center the points in the chart (without that code they are put
        // // on the left and the graph seems empty)
        // data.labels = data.labels.length > 1 ? data.labels : ["", ...data.labels, ""];
        const data = {
            "datasets":
                [
                    {
                        "label": "BTC/USD",
                        "data": [
                            {
                                "x": "2025-11-30 22:00:00",
                                "y": 91199.66525553692
                            },
                            {
                                "x": "2025-11-30 23:00:00",
                                "y": 91262.74064496571
                            },
                            {
                                "x": "2025-12-01 00:00:00",
                                "y": 90403.35950180818
                            },
                            {
                                "x": "2025-12-01 01:00:00",
                                "y": 87153.56192014978
                            },{"x":"2025-12-01 02:00:00","y":87245.43413351124},{"x":"2025-12-01 03:00:00","y":86780.03475472867},{"x":"2025-12-01 04:00:00","y":86407.28087505639},{"x":"2025-12-01 05:00:00","y":85810.6117510226},{"x":"2025-12-01 06:00:00","y":86007.65054034546},{"x":"2025-12-01 07:00:00","y":86272.34539592791},{"x":"2025-12-01 08:00:00","y":86563.22879385912},{"x":"2025-12-01 09:00:00","y":86883.52576369658},{"x":"2025-12-01 10:00:00","y":86748.18763247633},{"x":"2025-12-01 11:00:00","y":86669.24716065128},{"x":"2025-12-01 12:00:00","y":86198.16785503739},{"x":"2025-12-01 13:00:00","y":85500.06887423006},{"x":"2025-12-01 14:00:00","y":86007.10719664485},{"x":"2025-12-01 15:00:00","y":86134.55656200094},{"x":"2025-12-01 16:00:00","y":84649.44395837188},{"x":"2025-12-01 17:00:00","y":84546.64001375908},{"x":"2025-12-01 18:00:00","y":84979.52387091363},{"x":"2025-12-01 19:00:00","y":85233.33782420466},{"x":"2025-12-01 20:00:00","y":85062.79648399036},{"x":"2025-12-01 21:00:00","y":85447.24985446395},{"x":"2025-12-01 22:00:00","y":86443.89454379652},{"x":"2025-12-01 23:00:00","y":86623.62777091576},{"x":"2025-12-02 00:00:00","y":86337.86089653349},{"x":"2025-12-02 01:00:00","y":86526.10702535177},{"x":"2025-12-02 02:00:00","y":86470.14943327861},{"x":"2025-12-02 03:00:00","y":86555.5126404345},{"x":"2025-12-02 04:00:00","y":86980.41920649639},{"x":"2025-12-02 05:00:00","y":86975.41094690008},{"x":"2025-12-02 06:00:00","y":87027.80018227658},{"x":"2025-12-02 07:00:00","y":87125.09990495458},{"x":"2025-12-02 08:00:00","y":87033.13976586348},{"x":"2025-12-02 09:00:00","y":86447.49761700121},{"x":"2025-12-02 10:00:00","y":86797.54746231379},{"x":"2025-12-02 11:00:00","y":87307.20586221425},{"x":"2025-12-02 12:00:00","y":87376.48457230962},{"x":"2025-12-02 13:00:00","y":87264.75049417753},{"x":"2025-12-02 14:00:00","y":87809.50051644289},{"x":"2025-12-02 15:00:00","y":89237.18737614383},{"x":"2025-12-02 16:00:00","y":90625.47458856531},{"x":"2025-12-02 17:00:00","y":90859.87838915107},{"x":"2025-12-02 18:00:00","y":91489.81719045495},{"x":"2025-12-02 19:00:00","y":91934.66588678623},{"x":"2025-12-02 20:00:00","y":91927.8265621781},{"x":"2025-12-02 21:00:00","y":91076.14221944343},{"x":"2025-12-02 22:00:00","y":91593.78228702676},{"x":"2025-12-02 23:00:00","y":91986.80711526028},{"x":"2025-12-03 00:00:00","y":91308.25470880876},{"x":"2025-12-03 01:00:00","y":91599.9189425054},{"x":"2025-12-03 02:00:00","y":92245.96243507689},{"x":"2025-12-03 03:00:00","y":92799.33867858542},{"x":"2025-12-03 04:00:00","y":92693.95327860364},{"x":"2025-12-03 05:00:00","y":93308.95006003967},{"x":"2025-12-03 06:00:00","y":93654.74981798076},{"x":"2025-12-03 07:00:00","y":93435.530856218},{"x":"2025-12-03 08:00:00","y":92998.69139222911},{"x":"2025-12-03 09:00:00","y":92782.65358844612},{"x":"2025-12-03 10:00:00","y":93194.73374847478},{"x":"2025-12-03 11:00:00","y":92939.57995661821},{"x":"2025-12-03 12:00:00","y":93009.91307955467},{"x":"2025-12-03 13:00:00","y":92940.36667175479},{"x":"2025-12-03 14:00:00","y":93155.30787750629},{"x":"2025-12-03 15:00:00","y":92537.39159769732},{"x":"2025-12-03 16:00:00","y":92376.34193122551},{"x":"2025-12-03 17:00:00","y":92277.22814540748},{"x":"2025-12-03 18:00:00","y":92976.57383686704},{"x":"2025-12-03 19:00:00","y":92606.18491912256},{"x":"2025-12-03 20:00:00","y":93032.08770902421},{"x":"2025-12-03 21:00:00","y":92977.74814090607},{"x":"2025-12-03 22:00:00","y":93759.62096337772},{"x":"2025-12-03 23:00:00","y":93799.41587007897},{"x":"2025-12-04 00:00:00","y":93472.25736293846},{"x":"2025-12-04 01:00:00","y":93062.94125838652},{"x":"2025-12-04 02:00:00","y":93194.83559230302},{"x":"2025-12-04 03:00:00","y":93969.5138470154},{"x":"2025-12-04 04:00:00","y":93549.58104703884},{"x":"2025-12-04 05:00:00","y":93365.94611195878},{"x":"2025-12-04 06:00:00","y":92992.94025947318},{"x":"2025-12-04 07:00:00","y":93149.01664777873},{"x":"2025-12-04 08:00:00","y":93411.69962557609},{"x":"2025-12-04 09:00:00","y":93259.76541484684},{"x":"2025-12-04 10:00:00","y":93471.7618307987},{"x":"2025-12-04 11:00:00","y":93266.96565655089},{"x":"2025-12-04 12:00:00","y":92962.66703173224},{"x":"2025-12-04 13:00:00","y":93012.77336757717},{"x":"2025-12-04 14:00:00","y":92553.22101825594},{"x":"2025-12-04 15:00:00","y":91873.19043138971},{"x":"2025-12-04 16:00:00","y":93061.41034441005},{"x":"2025-12-04 17:00:00","y":92452.7471073435},{"x":"2025-12-04 18:00:00","y":92454.05137388581},{"x":"2025-12-04 19:00:00","y":92132.87429509932},{"x":"2025-12-04 20:00:00","y":92017.71969109496},{"x":"2025-12-04 21:00:00","y":92517.89777123553},{"x":"2025-12-04 22:00:00","y":92177.5333669068},{"x":"2025-12-04 23:00:00","y":92397.084895626},{"x":"2025-12-05 00:00:00","y":92111.78998497814},{"x":"2025-12-05 01:00:00","y":92322.36292178425},{"x":"2025-12-05 02:00:00","y":92380.56014537615},{"x":"2025-12-05 03:00:00","y":92535.93187047206},{"x":"2025-12-05 04:00:00","y":92170.42870035952},{"x":"2025-12-05 05:00:00","y":92037.95008312612},{"x":"2025-12-05 06:00:00","y":91949.90061141949},{"x":"2025-12-05 07:00:00","y":92288.84233442313},{"x":"2025-12-05 08:00:00","y":92263.40510234772},{"x":"2025-12-05 09:00:00","y":92105.04452686431},{"x":"2025-12-05 10:00:00","y":91096.85871292886},{"x":"2025-12-05 11:00:00","y":91329.44906475952},{"x":"2025-12-05 12:00:00","y":91367.65181903099},{"x":"2025-12-05 13:00:00","y":91252.53604731624},{"x":"2025-12-05 14:00:00","y":90581.07182425607},{"x":"2025-12-05 15:00:00","y":90260.40969763181},{"x":"2025-12-05 16:00:00","y":90452.74857487579},{"x":"2025-12-05 17:00:00","y":88910.15609754897},{"x":"2025-12-05 18:00:00","y":89348.2578384396},{"x":"2025-12-05 19:00:00","y":89004.47996262868},{"x":"2025-12-05 20:00:00","y":89704.23649173483},{"x":"2025-12-05 21:00:00","y":89311.13507211854},{"x":"2025-12-05 22:00:00","y":89184.0217618347},{"x":"2025-12-05 23:00:00","y":89278.07694332593},{"x":"2025-12-06 00:00:00","y":89368.95799385858},{"x":"2025-12-06 01:00:00","y":89435.11671560824},{"x":"2025-12-06 02:00:00","y":89331.33893402567},{"x":"2025-12-06 03:00:00","y":89376.2018738666},{"x":"2025-12-06 04:00:00","y":89702.25743134311},{"x":"2025-12-06 05:00:00","y":89687.26295173733},{"x":"2025-12-06 06:00:00","y":89636.22223574328},{"x":"2025-12-06 07:00:00","y":89699.58971771087},{"x":"2025-12-06 08:00:00","y":89612.22030353358},{"x":"2025-12-06 09:00:00","y":89306.58322100026},{"x":"2025-12-06 10:00:00","y":89595.5607533949},{"x":"2025-12-06 11:00:00","y":89537.15295887053},{"x":"2025-12-06 12:00:00","y":89642.62842430199},{"x":"2025-12-06 13:00:00","y":89607.58970576266},{"x":"2025-12-06 14:00:00","y":89687.27277930998},{"x":"2025-12-06 15:00:00","y":90049.24025982051},{"x":"2025-12-06 16:00:00","y":89856.49802114413},{"x":"2025-12-06 17:00:00","y":89722.09761160986},{"x":"2025-12-06 18:00:00","y":89713.28036020548},{"x":"2025-12-06 19:00:00","y":89651.28568156886},{"x":"2025-12-06 20:00:00","y":89413.78235472241},{"x":"2025-12-06 21:00:00","y":89563.90591122449},{"x":"2025-12-06 22:00:00","y":89443.89401350086},{"x":"2025-12-06 23:00:00","y":89316.8986425062},{"x":"2025-12-07 00:00:00","y":89242.07755906829},{"x":"2025-12-07 01:00:00","y":89476.81082574664},{"x":"2025-12-07 02:00:00","y":89350.86224093994},{"x":"2025-12-07 03:00:00","y":89635.26280517568},{"x":"2025-12-07 04:00:00","y":89721.98378930232},{"x":"2025-12-07 05:00:00","y":89551.36458886068},{"x":"2025-12-07 06:00:00","y":89536.26118753327},{"x":"2025-12-07 07:00:00","y":89691.99819358689},{"x":"2025-12-07 08:00:00","y":89370.10104929254},{"x":"2025-12-07 09:00:00","y":89328.45830185269},{"x":"2025-12-07 10:00:00","y":89120.30378187803},{"x":"2025-12-07 11:00:00","y":89271.87671742705},{"x":"2025-12-07 12:00:00","y":89172.17323994107},{"x":"2025-12-07 13:00:00","y":89488.90006656235},{"x":"2025-12-07 14:00:00","y":89067.8423930297},{"x":"2025-12-07 15:00:00","y":88246.41799357772},{"x":"2025-12-07 16:00:00","y":89510.53492637571},{"x":"2025-12-07 17:00:00","y":89626.24236427662},{"x":"2025-12-07 18:00:00","y":90953.34495797353},{"x":"2025-12-07 19:00:00","y":91368.73527837932},{"x":"2025-12-07 20:00:00","y":91369.77270935912},
                            {
                                "x": "2025-12-07 21:00:00",
                                "y": 91458.4020677047
                            }
                        ],
                        "backgroundColor": "rgba(111, 184, 71, 0.2)",
                        "borderColor": "rgba(111, 184, 71, 1)",
                        "borderWidth": 1,
                        "cubicInterpolationMode": "monotone"
                    }
                ]
            };
        // debugger;
        console.log("hello");
        // const data = this.props.data.chart.data;
        return data;
    }

    prepareOptions() {
        // const options = {
        //     maintainAspectRatio: false,
        //     scales: this.getScaleOptions(),
        //     plugins: {
        //         legend: this.getLegendOptions(),
        //         tooltip: this.getTooltipOptions(),
        //     },
        //     elements: this.getElementOptions(),
        //     onResize: () => {
        //         this.resizeChart(options);
        //     },
        //     animation: this.getAnimationOptions(),
        // };
        // options.interaction = {
        //     mode: "index",
        //     intersect: false,
        // };
        const options = {
            plugins: {
                legend: {
                    display: false
                }
            },
            elements: {
                point: {
                    radius: 0
                }
            },
            scales: {
                x: {
                    type: "time",
                    time: {
                        displayFormats: {
                            datetime: "MMM d, yyyy, h:mm:ss a",
                            millisecond: "h:mm:ss.SSS a",
                            second: "h:mm:ss a",
                            minute: "h:mm a",
                            hour: "MMM d, ha",
                            day: "MMM d",
                            week: "LLL d",
                            month: "MMM yyyy",
                            quarter: "'Q'Q - yyyy",
                            year: "yyyy"
                        }
                    }
                }
            }
        };
        return options;
    }

    getChartConfig() {
        let data = this.getLineChartData();
        const options = this.prepareOptions();
        const config = { data, options, type: "line" };
        // config.plugins = [gridOnTop];
        return config;
    }
}
